<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Timeline of Our Memories ❤️</title>

    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- GOOGLE FONT - PLAYFAIR DISPLAY -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet"/>

    <!-- LATEX RENDERER - KATEX -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "brand-dark": "#0D0D25",
              "brand-light": "#F0F0F0",
              "brand-accent": "#FF8C8C",
              "brand-secondary": "#4ECDC4",
              "brand-glow": "#F09C9C",
            },
            fontFamily: {
              serif: ["Playfair Display", "serif"],
              sans: ["Playfair Display", "serif"],
            },
          },
        },
      };
    </script>

    <style type="text/tailwindcss">
      :root {
        --bg-top: #0d0d25;
        --bg-bottom: #0d0d25;
        --constellation-opacity: 0;
      }

      /* Base Body Styles */
      body {
        @apply bg-brand-dark text-brand-light font-sans overflow-x-hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Background and Celestial Elements */
      #background-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -3; /* Deepest layer */
        background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
      }

      #celestial-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2; /* Above background, below content */
      }

      #sun,
      #moon {
        position: fixed;
        border-radius: 50%;
        z-index: -1;
      }

      #sun {
        top: 10vh;
        left: 10vw;
        width: clamp(60px, 15vmin, 150px);
        height: clamp(60px, 15vmin, 150px);
        background: radial-gradient(circle, #fff7b0, #ffd700);
        box-shadow: 0 0 40px #ffd700, 0 0 80px #fff7b0;
      }

      #moon {
        bottom: 15vh;
        right: 15vw;
        width: clamp(50px, 12vmin, 120px);
        height: clamp(50px, 12vmin, 120px);
        background: #f0f0e0;
        box-shadow: 0 0 30px #f0f0e0, 0 0 60px #ffffff,
          inset -25px -15px 40px #a9a9a9;
        opacity: 0;
      }

      /* Glowing Timeline Progress Bar */
      #progress-bar {
        @apply fixed top-0 left-0 w-1.5 h-full z-20;
        transform-origin: top;
      }
      #progress-fill {
        @apply w-full h-full bg-brand-glow rounded-b-full;
        box-shadow: 0 0 10px var(--tw-shadow-color),
          0 0 20px var(--tw-shadow-color);
        --tw-shadow-color: theme("colors.brand-glow");
        transform: scaleY(0);
        transform-origin: top;
      }

      /* Timeline Item Styling */
      .timeline-item {
        @apply max-w-2xl mx-auto px-6 py-8 md:py-12;
      }

      .memory-card,
      .question-card {
        @apply bg-white/5 backdrop-blur-xl rounded-2xl p-6 md:p-8 shadow-2xl border border-white/10;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.05),
          0 4px 30px rgba(0, 0, 0, 0.2);
      }

      /* Polaroid Photo Effect (Updated with Glassy Aesthetic) */
      .polaroid {
        @apply p-3 pb-16 rounded-lg relative transform rotate-[-180deg] transition-transform duration-300 hover:rotate-0;
        background: rgba(255, 255, 255, 0.08); /* Semi-transparent background */
        backdrop-filter: blur(10px); /* Glassy blur */
        border: 1px solid rgba(255, 255, 255, 0.432); /* Subtle light border */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1),
          inset 0 0 15px rgba(255, 255, 255, 0.05); /* Soft inner glow */
      }
      .polaroid img {
        @apply w-full h-auto object-cover rounded-md mt-8; /* Image itself is rounded */
        border: 2px solid rgba(255, 255, 255, 0.2); /* Inner image border, slightly more pronounced */
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.1); /* Subtle glow around the image */
      }
      .polaroid figcaption {
        @apply absolute bottom-4 left-4 right-4 text-center text-brand-light font-serif italic text-xl font-bold;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); /* Text shadow for readability */
      }

      /* Quiz Card Specifics */
      .question-card {
        @apply bg-brand-accent/10 border-brand-accent/20;
      }

      .answer-option {
        @apply block w-full bg-white/10 hover:bg-white/20 text-brand-light/80 font-thin py-3 px-4 my-2 rounded-lg transition-all duration-300 cursor-pointer border border-white/20 focus:outline-none focus:ring-2 focus:ring-brand-accent;
      }

      .answer-option.correct {
        @apply bg-brand-secondary/80 border-brand-secondary text-brand-dark font-semibold;
        animation: pulse-correct 0.8s ease-in-out;
      }

      .answer-option.incorrect {
        @apply bg-brand-accent/80 border-brand-accent text-white;
      }

      /* Confetti Animation */
      .confetti-container {
        @apply absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-50;
      }
      .confetti {
        @apply absolute w-2 h-4 opacity-0;
      }
      @keyframes pulse-correct {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
        100% {
          transform: scale(1);
        }
      }
    </style>
  </head>

  <body class="antialiased">
    <audio id="background-music" loop preload="auto">
      <source src="assets/audio/audio.mp3" type="audio/mpeg" />
    </audio>

    <div id="background-container"></div>
    <canvas id="celestial-canvas"></canvas>
    <div id="sun"></div>
    <div id="moon"></div>

    <div id="progress-bar">
      <div id="progress-fill"></div>
    </div>

    <main id="timeline-container" class="relative z-10 pt-20 pb-0">
      <header class="timeline-item text-center">
        <h1
          class="text-7xl md:text-7xl font-serif font-bold text-brand-light mb-8 mt-6 font-black"
          style="text-shadow: 0 2px 15px rgba(0, 0, 0, 0.4)"
        >
          Our Timeline
        </h1>
        <p class="text-base md:text-base text-brand-light/70 mt-8 font-thin">
          Scroll down to relive the moments that made us.
        </p>
      </header>

      <section class="timeline-item text-center">
        <div
          id="finale"
          class="min-h-screen flex flex-col items-center justify-center"
        >
          <h2 class="text-7xl md:text-7xl font-serif font-bold mb-6 mt-8">
            Our Love Graph
          </h2>
          <p class="text-base max-w-xl md:text-base text-brand-light/70 mb-8">
            Every moment, every laugh, every challenge... they all added up.
            This is how my love for you has grown—and continues to
            grow—infinitely.
          </p>
          <div class="w-full h-96 bg-white/5 backdrop-blur-xl rounded-xl p-4 shadow-2xl border border-white/10">
            <canvas id="loveGraph" class="w-full h-full"></canvas>
          </div>
          <div class="memory-card mt-8">
            <p class="text-brand-light/80 text-xl font-semibold italic">Our Journey Through Time:</p>
            <p class="mt-8 text-brand-light/80 text-sm font-thin">$ L(t) = \frac{28}{\frac{08}{25}} + \int_{0}^{t} \left( \frac{1}{\sqrt{x}} + \frac{\sin x + \cos x}{\sqrt{x}} \right) dx $</p>
            <p class="mt-8 text-brand-light/80 text-base font-black">$ L(t_0^+) = \lim_{t \to \infty} L(t) $</p>
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ===================================================================
        // ================== 1. CONTENT CONFIGURATION =======================
        // ===================================================================

        const timelineData = [
          {
            type: "memory",
            image: "https://placehold.co/600x400/FF8C8C/F0F0F0?text=First+Date",
            caption: "Our First Date",
            text: "It feels like just yesterday we were sitting across from each other, both a little nervous, not knowing this was the start of everything. The conversation flowed so easily, and I remember thinking I never wanted the night to end.",
          },
          {
            type: "question",
            question: "Where was our first official date?",
            answers: [
              "The Italian Restaurant",
              "The Park Cafe",
              "The Movie Theater",
              "The Art Museum",
            ],
            correctAnswer: "The Park Cafe",
          },
          {
            type: "memory",
            image: "https://placehold.co/600x400/4ECDC4/F0F0F0?text=First+Trip",
            caption: "Our First Road Trip",
            text: "Remember packing the car, the perfect playlist on repeat, and the endless open road ahead? That trip taught me how amazing we are as a team, navigating new places and creating unforgettable memories every mile.",
          },
          {
            type: "memory",
            image:
              "https://placehold.co/600x400/F79640/F0F0F0?text=Cozy+Nights",
            caption: "Cozy Movie Nights",
            text: "Some of my favorite memories are the simplest ones. Building a fort in the living room, surrounded by pillows and fairy lights, completely lost in a movie marathon. Those are the moments of pure, uncomplicated happiness.",
          },
          {
            type: "question",
            question: "What's my go-to snack for our movie nights?",
            answers: [
              "Popcorn with extra butter",
              "Chocolate covered pretzels",
              "Sour patch kids",
              "A mix of everything",
            ],
            correctAnswer: "Popcorn with extra butter",
          },
          {
            type: "memory",
            image:
              "https://placehold.co/600x400/89f7fe/0D0D25?text=Through+Thick+%26+Thin",
            caption: "Through Thick & Thin",
            text: "Life isn't always easy, but having you by my side makes every challenge conquerable. Your support is my rock, and your belief in me is my greatest strength. Thank you for being my constant.",
          },
        ];

        const loveGraphData = {
          labels: [
            "First Met",
            "First Trip",
            "Deep Talks",
            "Big Support",
            "Today",
            "Forever",
          ],
          data: [100, 200, 300, 400, 500, 1000], // Added 'Forever' to show it keeps growing
        };

        // ===================================================================
        // ================= 2. APPLICATION LOGIC ============================
        // ===================================================================

        gsap.registerPlugin(ScrollTrigger);
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true }, // Display math
            { left: "$", right: "$", display: false }, // Inline math
          ],
        });
        const timelineContainer = document.getElementById("timeline-container");
        const finaleSection = document.getElementById("finale");
        let questions = [];

        // --- Build Timeline from Data ---
        function buildTimeline() {
          let contentHtml = "";
          timelineData.forEach((item, index) => {
            if (item.type === "memory") {
              contentHtml += `
                        <section class="timeline-item">
                            <div class="memory-card">
                                <figure class="polaroid">
                                    <img src="${
                                      item.image
                                    }" alt="Memory Image ${
                index + 1
              }" loading="lazy">
                                    <figcaption>${item.caption}</figcaption>
                                </figure>
                                <p class="text-brand-light/80 md:text-lg mt-8">${
                                  item.text
                                }</p>
                            </div>
                        </section>`;
            } else if (item.type === "question") {
              const answersHtml = item.answers
                .map(
                  (answer) =>
                    `<button class="answer-option" data-correct="${
                      answer === item.correctAnswer
                    }">${answer}</button>`
                )
                .join("");
              contentHtml += `
                        <section class="timeline-item">
                            <div class="question-card relative" data-answered="false">
                                <div class="confetti-container"></div>
                                <h3 class="text-lg italic md:text-lg font-serif font-semibold mb-4">${item.question}</h3>
                                <div class="answers-container">${answersHtml}</div>
                            </div>
                        </section>`;
              questions.push(item);
            }
          });
          finaleSection.parentElement.insertAdjacentHTML(
            "beforebegin",
            contentHtml
          );
        }
        buildTimeline();

        // --- Interactive Quiz Logic ---
        document.querySelectorAll(".answers-container").forEach((container) => {
          container.addEventListener("click", (e) => {
            const button = e.target.closest(".answer-option");
            if (button && !button.disabled) {
              const parentCard = button.closest(".question-card");
              if (parentCard.dataset.answered === "true") return;
              parentCard.dataset.answered = "true";

              const isCorrect = button.dataset.correct === "true";
              parentCard
                .querySelectorAll(".answer-option")
                .forEach((opt) => (opt.disabled = true));

              if (isCorrect) {
                button.classList.add("correct");
                triggerConfetti(
                  parentCard.querySelector(".confetti-container")
                );
              } else {
                button.classList.add("incorrect");
                parentCard
                  .querySelector('[data-correct="true"]')
                  .classList.add("correct");
              }
            }
          });
        });

        function triggerConfetti(container) {
          for (let i = 0; i < 30; i++) {
            const c = document.createElement("div");
            c.classList.add("confetti");
            c.style.left = `${Math.random() * 100}%`;
            c.style.backgroundColor =
              Math.random() > 0.5 ? "#FF8C8C" : "#4ECDC4";
            const duration = 2 + Math.random() * 3;
            const delay = Math.random() * 1;
            c.style.animation = `fall ${duration}s ${delay}s linear forwards`;
            c.style.setProperty(
              "--rotate-deg",
              `${Math.random() * 720 - 360}deg`
            );
            container.appendChild(c);
            setTimeout(() => c.remove(), (duration + delay) * 1000 + 100);
          }
        }

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes fall { from { transform: translateY(-20px) rotate(0deg); opacity: 1; } to { transform: translateY(200px) rotate(var(--rotate-deg)); opacity: 0; } }`;
        document.head.appendChild(styleSheet);

        // ===================================================================
        // ================== 3. ANIMATION & EFFECTS =========================
        // ===================================================================

        // --- Background Music Control ---
        const music = document.getElementById("background-music");
        music.volume = 0;
        let musicPlayed = false;
        function playMusic() {
          if (!musicPlayed) {
            music.play().catch(() => {});
            musicPlayed = true;
          }
        }
        document.body.addEventListener("click", playMusic, { once: true });
        document.body.addEventListener("scroll", playMusic, { once: true });

        gsap.to(music, {
          volume: 0.5,
          scrollTrigger: {
            trigger: document.body,
            start: "top 10%",
            end: "bottom bottom",
            scrub: 1,
          },
        });

        // --- Background Day-to-Night Transition ---
        const bgTl = gsap.timeline({
          scrollTrigger: {
            trigger: "body",
            start: "top top",
            end: "bottom bottom",
            scrub: 1,
          },
        });

        bgTl
          .to(":root", { "--bg-top": "#0E97EC", "--bg-bottom": "#0E97EC" }, ">") // 7AM - 10AM
          .to(":root", { "--bg-top": "#0E97EC", "--bg-bottom": "#3B92C4" }, ">") // 10AM - 12PM
          .to(":root", { "--bg-top": "#3B92C4", "--bg-bottom": "#3B92C4" }, ">") // 12PM - 2PPM
          .to(":root", { "--bg-top": "#3B92C4", "--bg-bottom": "#3B92C4" }, ">") // 2PM - 4PM
          .to(":root", { "--bg-top": "#3B92C4", "--bg-bottom": "#F79640" }, ">") // 4PM - 5PM
          .to(":root", { "--bg-top": "#F79640", "--bg-bottom": "#BD4A1C" }, ">") // 5PM - 6PM
          .to(":root", { "--bg-top": "#BD4A1C", "--bg-bottom": "#4A1120" }, ">") // 6PM - 7PM
          .to(":root", { "--bg-top": "#4A1120", "--bg-bottom": "#210430" }, ">") // 7PM - 8PM
          .to(":root", { "--bg-top": "#210430", "--bg-bottom": "#0d021C" }, ">") // 8PM - 9PM
          .to(":root", { "--bg-top": "#0d021C", "--bg-bottom": "#0D0D25" }, ">") // 9PM - 10PM
          .to(":root", { "--bg-top": "#0D0D25", "--bg-bottom": "#0D0D15" }, ">") // 10PM - 11PM
          .to(
            ":root",
            { "--bg-top": "#0D0D15", "--bg-bottom": "#000000" },
            ">"
          ); // 11PM - 12AM

        gsap.to("#sun", {
          scrollTrigger: {
            trigger: "body",
            scrub: 1.5,
            end: "70% top",
            invalidateOnRefresh: true,
            anticipatePin: 1,
          },
          y: () => window.innerHeight,
          ease: "power1.inOut",
        });

        gsap.to("#moon", {
          scrollTrigger: { trigger: "body", scrub: 1, start: "50% top" },
          y: () => -window.innerHeight * 0.7,
          opacity: 1,
          ease: "power1.out",
        });

        // --- Glowing Progress Bar ---
        gsap.to("#progress-fill", {
          scaleY: 1,
          ease: "none",
          scrollTrigger: {
            trigger: "body",
            start: "top top",
            end: "bottom bottom",
            scrub: true,
          },
        });

        // --- Parallax Photos & Card Reveals ---
        document.querySelectorAll(".timeline-item").forEach((item) => {
          gsap.from(item, {
            opacity: 0,
            y: 50,
            ease: "power2.out",
            scrollTrigger: {
              trigger: item,
              start: "top 20%",
              toggleActions: "play none none none",
            },
          });

          const polaroid = item.querySelector(".polaroid img");
          if (polaroid) {
            gsap.to(polaroid, {
              yPercent: -10,
              ease: "none",
              scrollTrigger: { trigger: item, scrub: 1.5 },
            });
          }
        });

        // --- Celestial Canvas (Stars, Particles, Constellations) ---
        const canvas = document.getElementById("celestial-canvas");
        const ctxCanvas = canvas.getContext("2d");
        let stars = [],
          particles = [],
          shootingStars = [];

        function resizeCanvas() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        // Star generation
        const starCount = 200;
        const heartConstellationIndices = [
          0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 0,
        ];

        for (let i = 0; i < starCount; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            radius: Math.random() * 1.2 + 0.5,
            alpha: Math.random() * 0.5 + 0.5,
            twinkleSpeed: Math.random() * 0.1,
          });
        }

        // Heart constellation points (normalized coordinates)
        const heartPoints = [
          [0.5, 0.4],
          [0.45, 0.3],
          [0.35, 0.3],
          [0.3, 0.4],
          [0.3, 0.5],
          [0.35, 0.6],
          [0.45, 0.7],
          [0.5, 0.8],
          [0.55, 0.7],
          [0.65, 0.6],
          [0.7, 0.5],
          [0.7, 0.4],
          [0.65, 0.3],
          [0.55, 0.3],
        ];
        // Replace first few stars with constellation points for guaranteed shape
        heartPoints.forEach((p, i) => {
          if (stars[i]) {
            stars[i].x = p[0] * canvas.width;
            stars[i].y = p[1] * canvas.height;
            stars[i].radius = 1.5;
          }
        });

        // Ambient particles (hearts)
        const particleCount = 15;
        for (let i = 0; i < particleCount; i++) {
          particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            speed: Math.random() * 0.2 + 0.1,
            alpha: Math.random() * 0.3 + 0.1,
          });
        }

        function drawHeart(x, y, size, alpha) {
          ctxCanvas.fillStyle = `rgba(255, 178, 178, ${alpha})`;
          ctxCanvas.beginPath();
          ctxCanvas.moveTo(x, y + size / 4);
          ctxCanvas.bezierCurveTo(
            x,
            y,
            x - size / 2,
            y,
            x - size / 2,
            y + size / 4
          );
          ctxCanvas.bezierCurveTo(
            x - size / 2,
            y + size / 2,
            x,
            y + size * 0.8,
            x,
            y + size
          );
          ctxCanvas.bezierCurveTo(
            x,
            y + size * 0.8,
            x + size / 2,
            y + size / 2,
            x + size / 2,
            y + size / 4
          );
          ctxCanvas.bezierCurveTo(x + size / 2, y, x, y, x, y + size / 4);
          ctxCanvas.fill();
        }

        // --- Main Animation Loop for Canvas ---
        let shootingStarOpacity = 1;
        function animate() {
          requestAnimationFrame(animate);
          ctxCanvas.clearRect(0, 0, canvas.width, canvas.height);

          // Draw stars
          stars.forEach((star) => {
            star.alpha += star.twinkleSpeed;
            if (star.alpha > 1 || star.alpha < 0.2) star.twinkleSpeed *= -1;
            ctxCanvas.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
            ctxCanvas.beginPath();
            ctxCanvas.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
            ctxCanvas.fill();
          });

          // Draw constellation
          const constellationOpacity = parseFloat(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--constellation-opacity"
            )
          );
          if (constellationOpacity > 0) {
            ctxCanvas.strokeStyle = `rgba(255, 178, 178, ${
              constellationOpacity * 0.7
            })`;
            ctxCanvas.lineWidth = 1;
            ctxCanvas.beginPath();
            for (let i = 0; i < heartConstellationIndices.length - 1; i++) {
              const startNode = stars[heartConstellationIndices[i]];
              const endNode = stars[heartConstellationIndices[i + 1]];
              ctxCanvas.moveTo(startNode.x, startNode.y);
              ctxCanvas.lineTo(endNode.x, endNode.y);
            }
            ctxCanvas.stroke();
          }

          // Draw ambient particles (hearts)
          particles.forEach((p) => {
            p.y -= p.speed;
            if (p.y < -10) {
              p.y = canvas.height + 10;
              p.x = Math.random() * canvas.width;
            }
            drawHeart(p.x, p.y, 10, p.alpha);
          });

          // Spawn and draw shooting stars
          if (Math.random() < 0.05 && shootingStarOpacity > 0.1) {
            shootingStars.push({
              x: Math.random() * canvas.width * 1.5,
              y: -20,
              len: Math.random() * 50 + 50,
              speed: Math.random() * 3 + 2,
              alpha: 1,
            });
          }
          shootingStars.forEach((s, index) => {
            s.x -= s.speed;
            s.y += s.speed * 0.6;
            s.alpha -= 0.01;
            if (s.alpha <= 0) shootingStars.splice(index, 1);

            ctxCanvas.beginPath();
            const grad = ctxCanvas.createLinearGradient(
              s.x,
              s.y,
              s.x + s.len,
              s.y - s.len * 0.6
            );
            grad.addColorStop(
              0,
              `rgba(255, 255, 255, ${s.alpha * shootingStarOpacity})`
            );
            grad.addColorStop(1, "rgba(255, 255, 255, 0)");
            ctxCanvas.strokeStyle = grad;
            ctxCanvas.lineWidth = 2;
            ctxCanvas.moveTo(s.x, s.y);
            ctxCanvas.lineTo(s.x + s.len, s.y - s.len * 0.6);
            ctxCanvas.stroke();
          });
        }
        animate();

        // GSAP triggers for canvas effects
        gsap.to(":root", {
          "--constellation-opacity": 1,
          scrollTrigger: { trigger: "#finale", start: "top 80%", scrub: 1 },
        });

        gsap.to(shootingStars, {
          // A bit of a hack, we animate a proxy value
          proxy: 1,
          scrollTrigger: {
            trigger: "body",
            start: "10% top",
            end: "50% top",
            scrub: true,
            onUpdate: (self) => {
              shootingStarOpacity = 1 - self.progress;
            },
          },
        });

        // --- Love Graph (Chart.js) ---
        const loveGraphCtx = document
          .getElementById("loveGraph")
          .getContext("2d");
        let loveChart;

        ScrollTrigger.create({
          trigger: "#finale",
          start: "top 50%",
          once: true,
          onEnter: () => {
            loveChart = new Chart(loveGraphCtx, {
              type: "line",
              data: {
                labels: loveGraphData.labels,
                datasets: [
                  {
                    label: "Our Love Growth",
                    data: loveGraphData.data,
                    borderColor: "rgba(255, 5, 50, 0.5)",
                    backgroundColor: "rgba(217, 50, 71, 0.1)",
                    fill: true,
                    tension: 0.5,
                    pointBackgroundColor: "rgba(245, 120, 130, 0.75)",
                    pointBorderColor: "BLACK",
                    pointRadius: 6,
                    pointHoverRadius: 9,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 2500, easing: "easeInOutQuart" },
                scales: {
                  y: {
                    beginAtZero: true,
                    max: Math.max(...loveGraphData.data) + 100,
                    grid: { color: "rgba(255,255,255,0.1)" },
                    ticks: {
                      color: "#F0F0F0",
                      font: { family: "'Playfair Display', serif" },
                    },
                  },
                  x: {
                    grid: { color: "rgba(255,255,255,0.1)" },
                    ticks: {
                      color: "#F0F0F0",
                      font: { family: "'Playfair Display', serif" },
                      rotation: 90
                    },
                  },
                },
                plugins: {
                  legend: { display: false },
                  tooltip: {
                    enabled: true,
                    backgroundColor: "#0D0D25",
                    titleFont: {
                      family: "'Playfair Display', serif",
                      size: 16,
                    },
                    bodyFont: { family: "'Playfair Display', serif" },
                    padding: 12,
                    cornerRadius: 6,
                  },
                },
              },
            });
          },
        });

        gsap.from("#finale", {
          opacity: 0,
          duration: 1,
          scrollTrigger: { trigger: "#finale", start: "top 10%" },
        });
      });
    </script>
  </body>
</html>
